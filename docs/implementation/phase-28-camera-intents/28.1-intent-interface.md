# 28.1 ICameraIntent Interface + CameraContext-Erweiterung

> **Commit:** `feat(phase-28): 28.1 ICameraIntent Interface + CameraContext-Erweiterung`
> **Branch:** `feat/camera-intent-interface` (vom Integration-Branch)

---

## Ziel

Das **ICameraIntent Interface** definieren, das externen Systemen (Combat, Mount, Ability) erlaubt, die Kamera zu beeinflussen. Zusätzlich **ICameraPresetReceiver** als optionales Interface für Behaviours, die Preset-Werte empfangen können. Die **CameraContext**-Klasse um Felder für Character-Velocity und -Forward erweitern.

---

## Neue Dateien

### 1. ICameraIntent.cs

**Pfad:** `Packages/Wiesenwischer.GameKit.Camera.Core/Runtime/Core/ICameraIntent.cs`

```csharp
namespace Wiesenwischer.GameKit.Camera
{
    /// <summary>
    /// Transiente Kamera-Beeinflussung durch externe Systeme.
    /// Intents werden vom CameraBrain nach Priorität sortiert und auf den CameraState angewendet.
    /// Höhere Priorität = wird zuletzt angewendet (überschreibt).
    /// </summary>
    public interface ICameraIntent
    {
        /// <summary>
        /// Priorität des Intents. Höhere Werte überschreiben niedrigere.
        /// Empfohlene Bereiche:
        ///   0-99: Ambient (Movement Forward Bias, Idle Look-Around)
        ///  100-199: Gameplay (Soft Targeting, Conversation)
        ///  200-299: Combat (Framing, Lock-On)
        ///  300-399: Override (Cutscene, Forced Camera)
        /// </summary>
        int Priority { get; }

        /// <summary>
        /// Ist der Intent aktuell aktiv? Inaktive Intents werden übersprungen.
        /// </summary>
        bool IsActive { get; }

        /// <summary>
        /// Wendet den Intent auf den aktuellen CameraState an.
        /// Kann einzelne Felder modifizieren (z.B. nur Yaw) oder den ganzen State.
        /// </summary>
        void Apply(ref CameraState state, CameraContext ctx);
    }
}
```

### 2. ICameraPresetReceiver.cs

**Pfad:** `Packages/Wiesenwischer.GameKit.Camera.Core/Runtime/Core/ICameraPresetReceiver.cs`

```csharp
namespace Wiesenwischer.GameKit.Camera
{
    /// <summary>
    /// Optionales Interface für ICameraBehaviours die Preset-Werte empfangen können.
    /// CameraBrain.SetPreset() prüft jedes Behaviour auf dieses Interface.
    /// </summary>
    public interface ICameraPresetReceiver
    {
        /// <summary>
        /// Übernimmt die relevanten Werte aus dem Preset.
        /// Jedes Behaviour liest nur die für sich relevanten Felder.
        /// </summary>
        void ApplyPreset(CameraPreset preset);
    }
}
```

### 3. CameraContext.cs (Erweiterung)

**Pfad:** `Packages/Wiesenwischer.GameKit.Camera.Core/Runtime/Core/CameraContext.cs`

Zwei neue Felder hinzufügen:

```csharp
namespace Wiesenwischer.GameKit.Camera
{
    public class CameraContext
    {
        // --- Bestehende Felder ---
        public Transform FollowTarget;
        public Transform LookTarget;
        public CameraInputState Input;
        public Vector3 AnchorPosition;
        public float DeltaTime;

        // --- Phase 28: Neue Felder ---

        /// <summary>
        /// Welt-Geschwindigkeit des Follow-Targets (Character).
        /// Wird vom CameraBrain aus dem CharacterController gelesen.
        /// Benötigt für DynamicOrbitCenter und Soft Targeting.
        /// </summary>
        public Vector3 CharacterVelocity;

        /// <summary>
        /// Forward-Richtung des Follow-Targets (Character).
        /// Wird vom CameraBrain aus FollowTarget.forward gelesen.
        /// Benötigt für RecenterBehaviour und DynamicOrbitCenter.
        /// </summary>
        public Vector3 CharacterForward;
    }
}
```

---

## Anweisungen

### Schritt 1: ICameraIntent.cs erstellen

1. Erstelle `Packages/Wiesenwischer.GameKit.Camera.Core/Runtime/Core/ICameraIntent.cs`
2. Implementiere das Interface exakt wie oben beschrieben
3. Prioritätsbereiche als XML-Doc dokumentieren

### Schritt 2: ICameraPresetReceiver.cs erstellen

1. Erstelle `Packages/Wiesenwischer.GameKit.Camera.Core/Runtime/Core/ICameraPresetReceiver.cs`
2. Das Interface hat eine einzige Methode: `ApplyPreset(CameraPreset preset)`
3. `CameraPreset` wird in Schritt 28.2 implementiert — hier erstmal als Forward-Deklaration im selben Namespace

**Hinweis:** Da `CameraPreset` erst in 28.2 erstellt wird, kann `ICameraPresetReceiver` entweder:
- Zusammen mit CameraPreset in 28.2 erstellt werden (einfacher), oder
- In 28.1 mit `CameraPreset` als Stub-Klasse erstellt werden

**Empfehlung:** ICameraPresetReceiver zusammen mit CameraPreset in 28.2 erstellen. In 28.1 nur ICameraIntent.

### Schritt 3: CameraContext erweitern

1. Öffne `CameraContext.cs`
2. Füge `CharacterVelocity` (Vector3) hinzu
3. Füge `CharacterForward` (Vector3) hinzu
4. XML-Docs für beide Felder

**Wichtig:** Die bestehenden Felder NICHT ändern. Nur neue Felder hinzufügen.

---

## Verifikations-Checkliste

- [ ] `ICameraIntent.cs` existiert in `Camera.Core/Runtime/Core/`
- [ ] Interface hat `Priority`, `IsActive` und `Apply(ref CameraState, CameraContext)`
- [ ] `CameraContext.cs` hat neue Felder `CharacterVelocity` und `CharacterForward`
- [ ] Bestehende CameraContext-Felder unverändert
- [ ] Projekt kompiliert fehlerfrei
- [ ] Bestehende Tests laufen weiterhin grün

---

## Erwartete Dateien nach diesem Schritt

```
Packages/Wiesenwischer.GameKit.Camera.Core/Runtime/Core/
├── ICameraIntent.cs        (NEU)
├── ICameraBehaviour.cs     (unverändert)
├── CameraState.cs          (unverändert)
├── CameraInputState.cs     (unverändert)
├── CameraContext.cs         (ERWEITERT)
└── CameraCoreConfig.cs     (unverändert)
```

---

## Nächster Schritt

→ [28.2 CameraPreset ScriptableObject + Package](28.2-camera-preset.md)
