# 27.6 Unit Tests

> **Commit:** `feat(phase-27): 27.6 Unit Tests`

---

## Ziel

Unit Tests für alle Camera Behaviours und den refactored CameraBrain.

---

## Test-Projekt

**`Packages/Wiesenwischer.GameKit.Camera.Behaviours/Tests/Wiesenwischer.GameKit.Camera.Behaviours.Tests.asmdef`**
```json
{
  "name": "Wiesenwischer.GameKit.Camera.Behaviours.Tests",
  "rootNamespace": "Wiesenwischer.GameKit.Camera.Behaviours.Tests",
  "references": [
    "Wiesenwischer.GameKit.Camera.Core.Runtime",
    "Wiesenwischer.GameKit.Camera.Behaviours.Runtime",
    "UnityEngine.TestRunner",
    "UnityEditor.TestRunner"
  ],
  "includePlatforms": ["Editor"],
  "optionalUnityReferences": ["TestAssemblies"],
  "defineConstraints": ["UNITY_INCLUDE_TESTS"]
}
```

---

## Test-Klassen

### 1. OrbitBehaviourTests

```
- UpdateState_AddsLookXToYaw
  → LookX=5 → Yaw erhöht sich um 5

- UpdateState_SubtractsLookYFromPitch
  → LookY=10 → Pitch sinkt um 10

- UpdateState_ClampsPitch
  → LookY sehr groß → Pitch bleibt innerhalb Min/Max

- UpdateState_NoInput_NoChange
  → LookX=0, LookY=0 → State unverändert
```

### 2. ZoomBehaviourTests

```
- UpdateState_ZoomIn_ReducesDistance
  → Zoom > 0 → Distance sinkt

- UpdateState_ClampsToMinDistance
  → Viel Zoom-In → Distance nicht unter Min

- UpdateState_ClampsToMaxDistance
  → Viel Zoom-Out → Distance nicht über Max

- Initialize_SetsDefaultDistance
  → Initialize() setzt Distance auf Default-Wert
```

### 3. CollisionBehaviourTests

```
- UpdateState_NoCollision_DistanceUnchanged
  → Keine Hindernisse → Distance bleibt

- UpdateState_Disabled_DistanceUnchanged
  → IsActive=false → keine Änderung
```

**Hinweis:** SphereCast-Tests brauchen physische Collider in der Szene → nur teilweise als Unit Test möglich. Kollisions-Logik wird primär manuell in Play Mode verifiziert.

### 4. InertiaBehaviourTests

```
- UpdateState_FirstFrame_NoChange
  → Initialisierung → AnchorPosition unverändert

- UpdateState_TargetMoved_PositionFollowsWithLag
  → Target bewegt → AnchorPosition folgt aber nicht sofort

- Snap_SetsPositionImmediately
  → Snap() → Position sofort am Target

- UpdateState_Idle_ConvergesToTarget
  → Viele Frames ohne Bewegung → Position = Target
```

### 5. RecenterBehaviourTests

```
- UpdateState_WithLookInput_DoesNotRecenter
  → Look-Input vorhanden → Yaw bleibt

- UpdateState_AfterDelay_RecentersToMovement
  → Kein Input, Target bewegt → Yaw dreht Richtung Movement

- UpdateState_NoMovement_DoesNotRecenter
  → Kein Input, Target steht still → Yaw bleibt
```

### 6. ShoulderOffsetBehaviourTests

```
- UpdateState_SetsShoulderOffset
  → ShoulderOffset wird auf konfigurierten Wert gesetzt

- SwitchSide_NegatesOffsetX
  → SwitchSide() → OffsetX wechselt Vorzeichen

- SwitchSide_SmoothTransition
  → Nach SwitchSide + wenige Frames → OffsetX zwischen alt und neu
```

---

## Akzeptanzkriterien

- [ ] Alle Tests kompilieren fehlerfrei
- [ ] Alle Tests sind grün
- [ ] OrbitBehaviour: Yaw/Pitch-Modifikation getestet
- [ ] ZoomBehaviour: Distance-Clamp getestet
- [ ] InertiaBehaviour: Spring-Damper-Konvergenz getestet
- [ ] RecenterBehaviour: Delay + Movement-Richtung getestet
- [ ] ShoulderOffsetBehaviour: Side-Switch getestet
