# 20.4 Verifikation in AnimationTestScene

> **Branch:** `feat/grounding-smoother-integration` (gleicher Branch wie 20.3)
> **Commit:** `test(phase-20): 20.4 Verifikation`

---

## Ziel

Visuell und funktional verifizieren, dass der GroundingSmoother korrekt arbeitet. Die AnimationTestScene hat bereits einen Treppen-Bereich.

---

## Visuelle Tests

Alle Tests werden in der AnimationTestScene durchgeführt (Play Mode im Editor).

### Treppen hoch

| Test | Erwartung | Bestanden |
|------|-----------|-----------|
| Character läuft Treppen hoch (Run) | Mesh gleitet hoch, kein Springen | ☐ |
| Character läuft Treppen hoch (Walk) | Mesh gleitet hoch, langsameres Smoothing sichtbar | ☐ |
| Character sprintet Treppen hoch | Mesh gleitet, schnelle Step-Akkumulation funktioniert | ☐ |

### Treppen runter

| Test | Erwartung | Bestanden |
|------|-----------|-----------|
| Character läuft Treppen runter (Run) | Mesh senkt sich sanft, kein Fallen | ☐ |
| Character läuft Treppen runter (Walk) | Mesh senkt sich, Smoothing sichtbar | ☐ |

### Flacher Boden & Slopes

| Test | Erwartung | Bestanden |
|------|-----------|-----------|
| Character läuft auf flachem Boden | Kein sichtbarer Effekt (Offset = 0) | ☐ |
| Character läuft Rampe hoch | Kein sichtbarer Effekt (kontinuierliche Y-Änderung) | ☐ |
| Character läuft Rampe runter | Kein sichtbarer Effekt | ☐ |

### Sprung & Landung

| Test | Erwartung | Bestanden |
|------|-----------|-----------|
| Character springt von flachem Boden | Offset sofort 0 bei Airborne | ☐ |
| Character landet nach Sprung | Kein falscher Offset nach Landing | ☐ |
| Character springt auf Treppen → fällt | Kein Smoothing während Fall, Landing korrekt | ☐ |

### Edge Cases

| Test | Erwartung | Bestanden |
|------|-----------|-----------|
| Treppen hoch → Kante → Fall | Offset wird bei Airborne sofort 0, Fall startet sauber | ☐ |
| Teleport (große Y-Distanz) | Kein Smoothing, sofortige Position | ☐ |

### Deaktivierung

| Test | Erwartung | Bestanden |
|------|-----------|-----------|
| Komponente im Inspector disablen | Mesh folgt Motor direkt (Fallback) | ☐ |
| `_smoothTime` auf 0 setzen | Kein Smoothing (sofortige Position) | ☐ |
| `_smoothTime` auf 0.15 erhöhen | Weicheres, langsameres Smoothing | ☐ |

---

## Performance-Check

| Aspekt | Erwartung | Bestanden |
|--------|-----------|-----------|
| Kein GC-Alloc pro Frame | Profiler zeigt 0 Allocs in GroundingSmoother | ☐ |
| CPU-Last minimal | Nur 1 SmoothDamp + 1 Vector3-Zuweisung pro Frame | ☐ |
| Kein Einfluss auf Physics | PhysX-Timings unverändert | ☐ |

**Profiler-Anleitung:**
1. Window → Analysis → Profiler
2. CPU Modul → Deep Profile aktivieren
3. Szene im Play Mode starten
4. In der Hierarchy nach `GroundingSmoother.LateUpdate` suchen
5. GC Alloc-Spalte prüfen (muss 0 sein)

---

## Tuning

Falls das Smoothing nicht optimal aussieht:

| Feeling | smoothTime | Effekt |
|---------|------------|--------|
| Snappy (responsiv) | 0.04s | Kaum Smoothing, fast sofort |
| **Balanced** | **0.075s** | **Guter Kompromiss (Default)** |
| Weich (cinematisch) | 0.15s | Sehr flüssig, leicht verzögert |

`_maxStepDelta` sollte ≥ `LocomotionConfig.MaxStepHeight` sein. Bei zu kleinem Wert werden echte Steps als Teleport interpretiert und nicht geglättet.

---

## Verifikation

- [ ] Alle visuellen Tests bestanden
- [ ] Performance-Check bestanden (0 GC Allocs)
- [ ] Default-Werte fühlen sich gut an (oder angepasst und dokumentiert)
- [ ] Kompilierung fehlerfrei
- [ ] Unity Editor Log ohne Errors

---

## Phase 20 abgeschlossen

Nach erfolgreichem Abschluss aller Verifikationen:
1. Feature-Branch in Integration-Branch mergen
2. Integration-Branch prüfen
3. Weiter mit Phase 8 (IK System) oder anderer priorisierter Phase
