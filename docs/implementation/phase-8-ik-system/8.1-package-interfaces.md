# 8.1 Package-Struktur & IIKModule Interface

> **Branch:** `feat/ik-package-interfaces`
> **Commit:** `feat(phase-8): 8.1 IK Package & IIKModule Interface`

---

## Ziel

Neues Unity-Package `Wiesenwischer.GameKit.CharacterController.IK` anlegen mit den Basis-Interfaces für das modulare IK-System.

---

## Dateien

| Aktion | Pfad |
|--------|------|
| Erstellen | `Packages/Wiesenwischer.GameKit.CharacterController.IK/package.json` |
| Erstellen | `Packages/Wiesenwischer.GameKit.CharacterController.IK/Runtime/Wiesenwischer.GameKit.CharacterController.IK.asmdef` |
| Erstellen | `Packages/Wiesenwischer.GameKit.CharacterController.IK/Runtime/Core/IIKModule.cs` |
| Erstellen | `Packages/Wiesenwischer.GameKit.CharacterController.IK/Runtime/Core/IIKTargetProvider.cs` |
| Erstellen | `Packages/Wiesenwischer.GameKit.CharacterController.IK/Runtime/Core/IKGoal.cs` |
| Erstellen | `Packages/Wiesenwischer.GameKit.CharacterController.IK/Tests/Runtime/Wiesenwischer.GameKit.CharacterController.IK.Tests.asmdef` |

---

## Package-Struktur

```
Packages/Wiesenwischer.GameKit.CharacterController.IK/
├── package.json
├── Runtime/
│   ├── Wiesenwischer.GameKit.CharacterController.IK.asmdef
│   └── Core/
│       ├── IIKModule.cs
│       ├── IIKTargetProvider.cs
│       └── IKGoal.cs
└── Tests/
    └── Runtime/
        └── Wiesenwischer.GameKit.CharacterController.IK.Tests.asmdef
```

**Namespace:** `Wiesenwischer.GameKit.CharacterController.IK`

---

## Detaillierte Anweisungen

### package.json

```json
{
  "name": "com.wiesenwischer.gamekit.charactercontroller.ik",
  "version": "0.1.0",
  "displayName": "Wiesenwischer GameKit - CharacterController IK",
  "description": "Modulares IK-System für Character-Animation (Foot IK, LookAt IK, Hand IK)",
  "unity": "2022.3",
  "dependencies": {
    "com.wiesenwischer.gamekit.charactercontroller.core": "0.1.0"
  }
}
```

**Hinweis:** Keine Abhängigkeit auf das Animation-Package nötig. Der `IKManager` arbeitet direkt mit Unity's `Animator` API (`SetIKPosition`, `SetLookAtPosition`).

### Assembly Definition (Runtime)

```json
{
  "name": "Wiesenwischer.GameKit.CharacterController.IK",
  "rootNamespace": "Wiesenwischer.GameKit.CharacterController.IK",
  "references": [
    "Wiesenwischer.GameKit.CharacterController.Core"
  ]
}
```

### Assembly Definition (Tests)

```json
{
  "name": "Wiesenwischer.GameKit.CharacterController.IK.Tests",
  "rootNamespace": "Wiesenwischer.GameKit.CharacterController.IK.Tests",
  "references": [
    "Wiesenwischer.GameKit.CharacterController.IK",
    "Wiesenwischer.GameKit.CharacterController.Core",
    "UnityEngine.TestRunner",
    "UnityEditor.TestRunner"
  ],
  "includePlatforms": [],
  "defineConstraints": ["UNITY_INCLUDE_TESTS"],
  "autoReferenced": false
}
```

### IKGoal Enum

```csharp
namespace Wiesenwischer.GameKit.CharacterController.IK
{
    /// <summary>
    /// IK-Ziele, die Module setzen können.
    /// Mapped direkt auf Unity's AvatarIKGoal.
    /// </summary>
    public enum IKGoal
    {
        LeftFoot,
        RightFoot,
        LeftHand,
        RightHand
    }
}
```

### IIKModule Interface

```csharp
using UnityEngine;

namespace Wiesenwischer.GameKit.CharacterController.IK
{
    /// <summary>
    /// Interface für ein IK-Modul. Module werden vom IKManager orchestriert
    /// und im OnAnimatorIK-Callback aufgerufen.
    /// </summary>
    public interface IIKModule
    {
        /// <summary>
        /// Anzeigename für Debug/Editor.
        /// </summary>
        string Name { get; }

        /// <summary>
        /// Ob das Modul aktiv ist. Inaktive Module werden nicht aufgerufen.
        /// </summary>
        bool IsEnabled { get; set; }

        /// <summary>
        /// Globaler Weight des Moduls (0 = kein IK, 1 = voller IK-Einfluss).
        /// Wird vom IKManager an die Unity IK API weitergegeben.
        /// </summary>
        float Weight { get; set; }

        /// <summary>
        /// Wird vom IKManager in OnAnimatorIK aufgerufen.
        /// Das Modul soll hier Animator.SetIKPosition/Rotation/LookAt aufrufen.
        /// </summary>
        /// <param name="animator">Der Animator mit IK-Pass</param>
        /// <param name="layerIndex">Aktueller Animator Layer (meist 0)</param>
        void ProcessIK(Animator animator, int layerIndex);

        /// <summary>
        /// Wird in LateUpdate aufgerufen, um IK-Ziele vorzubereiten
        /// (z.B. Raycasts, Target-Berechnung). Trennung von Vorbereitung
        /// und Anwendung, da OnAnimatorIK zu einem anderen Zeitpunkt läuft.
        /// </summary>
        void PrepareIK();
    }
}
```

### IIKTargetProvider Interface

```csharp
using UnityEngine;

namespace Wiesenwischer.GameKit.CharacterController.IK
{
    /// <summary>
    /// Liefert IK-Zielpunkte. Verschiedene Quellen möglich:
    /// - Kamera (LookAt-Target)
    /// - Gameplay (Gegner-Position für LookAt)
    /// - Netzwerk (Remote Player Target Sync)
    /// </summary>
    public interface IIKTargetProvider
    {
        /// <summary>
        /// Punkt, den der Character anschauen soll (für LookAt IK).
        /// </summary>
        Vector3 GetLookTarget();

        /// <summary>
        /// Ob aktuell ein gültiges LookAt-Target vorhanden ist.
        /// Wenn false, blendet LookAtIK den Weight auf 0.
        /// </summary>
        bool HasLookTarget { get; }
    }
}
```

---

## Verifikation

- [ ] Package-Ordner erstellt unter `Packages/Wiesenwischer.GameKit.CharacterController.IK/`
- [ ] `package.json` mit korrektem Namen und Dependency auf Core
- [ ] Runtime Assembly Definition mit Referenz auf Core
- [ ] Tests Assembly Definition mit `UNITY_INCLUDE_TESTS` Constraint
- [ ] `IKGoal` Enum mit 4 Werten (LeftFoot, RightFoot, LeftHand, RightHand)
- [ ] `IIKModule` Interface mit `Name`, `IsEnabled`, `Weight`, `ProcessIK()`, `PrepareIK()`
- [ ] `IIKTargetProvider` Interface mit `GetLookTarget()`, `HasLookTarget`
- [ ] Kompiliert fehlerfrei

---

## Nächster Schritt

→ [8.2 IKManager Komponente](8.2-ik-manager.md)
