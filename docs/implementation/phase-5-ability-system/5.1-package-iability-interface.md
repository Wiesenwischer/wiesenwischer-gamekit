# 5.1 Package-Struktur & IAbility Interface

> **Branch:** `feat/ability-package-core`
> **Commit:** `feat(phase-5): 5.1 Ability Package & IAbility Interface`

---

## Ziel

Neues Unity Package `Wiesenwischer.GameKit.Abilities.Core` anlegen mit dem grundlegenden `IAbility` Interface und zugehörigen Core-Typen.

---

## Dateien

| Aktion | Pfad |
|--------|------|
| Erstellen | `Packages/Wiesenwischer.GameKit.Abilities.Core/package.json` |
| Erstellen | `Packages/Wiesenwischer.GameKit.Abilities.Core/Runtime/Wiesenwischer.GameKit.Abilities.Core.asmdef` |
| Erstellen | `Packages/Wiesenwischer.GameKit.Abilities.Core/Runtime/Core/IAbility.cs` |
| Erstellen | `Packages/Wiesenwischer.GameKit.Abilities.Core/Runtime/Core/AbilityState.cs` |
| Erstellen | `Packages/Wiesenwischer.GameKit.Abilities.Core/Runtime/Core/AbilityPriority.cs` |
| Erstellen | `Packages/Wiesenwischer.GameKit.Abilities.Core/Tests/Runtime/Wiesenwischer.GameKit.Abilities.Core.Tests.Runtime.asmdef` |

---

## Package-Struktur

```
Packages/Wiesenwischer.GameKit.Abilities.Core/
├── package.json
├── Runtime/
│   ├── Wiesenwischer.GameKit.Abilities.Core.asmdef
│   └── Core/
│       ├── IAbility.cs
│       ├── AbilityState.cs
│       └── AbilityPriority.cs
├── Tests/
│   ├── Runtime/
│   │   └── Wiesenwischer.GameKit.Abilities.Core.Tests.Runtime.asmdef
│   └── Editor/
│       └── Wiesenwischer.GameKit.Abilities.Core.Tests.Editor.asmdef
└── CHANGELOG.md
```

---

## Detaillierte Anweisungen

### package.json

```json
{
  "name": "com.wiesenwischer.gamekit.abilities.core",
  "version": "0.1.0",
  "displayName": "Wiesenwischer GameKit - Abilities Core",
  "description": "Core ability system framework: IAbility interface, AbilitySystem manager, lifecycle management.",
  "unity": "2022.3",
  "dependencies": {
    "com.wiesenwischer.gamekit.charactercontroller.core": "0.1.0"
  }
}
```

### Assembly Definition (Runtime)

```json
{
  "name": "Wiesenwischer.GameKit.Abilities.Core",
  "rootNamespace": "Wiesenwischer.GameKit.Abilities.Core",
  "references": [
    "Wiesenwischer.GameKit.CharacterController.Core"
  ],
  "includePlatforms": [],
  "excludePlatforms": [],
  "allowUnsafeCode": false,
  "overrideReferences": false,
  "precompiledReferences": [],
  "autoReferenced": true,
  "defineConstraints": [],
  "versionDefines": [],
  "noEngineReferences": false
}
```

### IAbility Interface

**Namespace:** `Wiesenwischer.GameKit.Abilities.Core`

```csharp
/// <summary>
/// Core interface for all abilities in the GameKit system.
/// Abilities operate on the Ability Layer (orthogonal to the Movement State Machine).
/// The AbilitySystem manages the lifecycle of registered abilities.
/// </summary>
public interface IAbility
{
    /// <summary>Unique identifier for this ability instance.</summary>
    string Id { get; }

    /// <summary>Current lifecycle state of this ability.</summary>
    AbilityState State { get; }

    /// <summary>
    /// Priority for interruption logic. Higher priority abilities can
    /// interrupt lower priority ones. See AbilityPriority for defaults.
    /// </summary>
    int Priority { get; }

    /// <summary>
    /// Whether the ability can be activated in the current context.
    /// Called by AbilitySystem before activation. Checks conditions like
    /// grounding, resources, cooldown, gameplay tags etc.
    /// </summary>
    bool CanActivate(AbilityContext context);

    /// <summary>
    /// Activate the ability. Called by AbilitySystem after CanActivate returns true.
    /// Should trigger animations, apply effects, etc.
    /// </summary>
    void Activate(AbilityContext context);

    /// <summary>
    /// Called every frame while the ability is active.
    /// Used for continuous effects, timing windows, combo input etc.
    /// </summary>
    void Tick(AbilityContext context, float deltaTime);

    /// <summary>
    /// Deactivate the ability. Called when:
    /// - The ability completes naturally
    /// - A higher priority ability interrupts
    /// - The ability is cancelled externally
    /// </summary>
    void Deactivate(AbilityContext context);
}
```

### AbilityState Enum

```csharp
namespace Wiesenwischer.GameKit.Abilities.Core
{
    /// <summary>
    /// Lifecycle states of an ability instance.
    /// </summary>
    public enum AbilityState
    {
        /// <summary>Ready to be activated.</summary>
        Ready,

        /// <summary>Currently executing (between Activate and Deactivate).</summary>
        Active,

        /// <summary>On cooldown, cannot be activated.</summary>
        Cooldown,

        /// <summary>Disabled (e.g. by a status effect like Silence).</summary>
        Disabled
    }
}
```

### AbilityPriority (Statische Konstanten)

Basierend auf der AAA-Spec (Abschnitt 6: Priority System):

```csharp
namespace Wiesenwischer.GameKit.Abilities.Core
{
    /// <summary>
    /// Default priority values for ability categories.
    /// Higher value = higher priority = can interrupt lower priorities.
    /// Custom abilities can use any int value.
    /// </summary>
    public static class AbilityPriority
    {
        public const int Interaction = 1;   // Interact, Loot, Talk
        public const int Utility = 5;       // Buffs, Heals
        public const int Attack = 10;       // Melee, Ranged, Spells
        public const int Dodge = 20;        // Dodge roll, Evasion
        public const int Ultimate = 30;     // Ultimate abilities
        public const int ForcedStatus = 100; // Stun, Knockback (system-imposed)
    }
}
```

---

## Verifikation

- [ ] Package-Ordner erstellt unter `Packages/Wiesenwischer.GameKit.Abilities.Core/`
- [ ] `package.json` mit korrekter Dependency auf CharacterController.Core
- [ ] Runtime asmdef mit Reference auf CharacterController.Core
- [ ] Test asmdefs für Runtime und Editor
- [ ] `IAbility.cs` mit vollständigem Interface (Id, State, Priority, CanActivate, Activate, Tick, Deactivate)
- [ ] `AbilityState.cs` mit 4 Zuständen (Ready, Active, Cooldown, Disabled)
- [ ] `AbilityPriority.cs` mit Default-Konstanten
- [ ] Korrekte Namespaces (`Wiesenwischer.GameKit.Abilities.Core`)
- [ ] Kompiliert fehlerfrei

---

## Nächster Schritt

→ [5.2 AbilityDefinition & AbilityContext](5.2-ability-definition-context.md)
