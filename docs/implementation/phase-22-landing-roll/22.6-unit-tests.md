# 22.6 Unit Tests

> **Commit:** `test(phase-22): 22.6 Unit Tests für RollingState`
> **Branch:** `test/rolling-state-tests`

---

## Ziel

Unit Tests für den RollingState und die erweiterte FallingState-Transition erstellen — analog zu den bestehenden SlidingTests.

## Anweisungen

### 1. Test-Datei erstellen

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Core/Tests/Runtime/RollingTests.cs`

### 2. Test-Cases

Aus der Spezifikation (Abschnitt 9.1):

```csharp
using NUnit.Framework;

namespace Wiesenwischer.GameKit.CharacterController.Core.Tests
{
    [TestFixture]
    public class RollingTests
    {
        // === RollingState Behavior ===

        [Test]
        public void RollingState_Enter_SetsCorrectSpeedModifier()
        {
            // SpeedModifier = Config.RollSpeedModifier nach Enter
        }

        [Test]
        public void RollingState_Enter_DisablesSprint()
        {
            // ShouldSprint = false nach Enter
        }

        [Test]
        public void RollingState_BlocksJumpInput()
        {
            // OnJump() ist leer — Jump-Input wird ignoriert
        }

        [Test]
        public void RollingState_Exit_RestoresSpeedModifier()
        {
            // SpeedModifier = 1.0 nach Exit
        }

        [Test]
        public void RollingState_SetsCorrectRotation()
        {
            // Character rotiert sofort in Input-Richtung
        }

        // === Transition: Roll → Movement ===

        [Test]
        public void RollingState_TransitionsToRunning_WhenInputActive()
        {
            // Nach Animation-Ende + MoveInput → RunningState
        }

        [Test]
        public void RollingState_TransitionsToSprinting_WhenSprintHeld()
        {
            // Nach Animation-Ende + SprintHeld → SprintingState
        }

        [Test]
        public void RollingState_TransitionsToWalking_WhenShouldWalk()
        {
            // Nach Animation-Ende + ShouldWalk → WalkingState
        }

        [Test]
        public void RollingState_TransitionsToMediumStop_WhenNoInput()
        {
            // Nach Animation-Ende + kein Input → MediumStoppingState
        }

        // === Transition: FallingState → Roll ===

        [Test]
        public void FallingState_TransitionsToRoll_WhenMovementInput()
        {
            // HardLanding-Threshold + MoveInput + RollEnabled → RollingState
        }

        [Test]
        public void FallingState_TransitionsToHardLand_WhenNoInput()
        {
            // HardLanding-Threshold + kein MoveInput → HardLandingState
        }

        [Test]
        public void FallingState_NoRoll_WhenDisabled()
        {
            // RollEnabled=false + MoveInput → HardLandingState (immer)
        }

        [Test]
        public void FallingState_TransitionsToRoll_WhenButtonPressed()
        {
            // ButtonPress Modus + DashPressed → RollingState
        }

        [Test]
        public void FallingState_NoRoll_WhenButtonNotPressed()
        {
            // ButtonPress Modus + !DashPressed → HardLandingState
        }

        // === Config ===

        [Test]
        public void RollTriggerMode_DefaultIsMovementInput()
        {
            // Default-Wert prüfen
        }

        [Test]
        public void RollSpeedModifier_ClampsToRange()
        {
            // 0.5–2.0 Range
        }
    }
}
```

### 3. Test-Infrastruktur

Die Tests verwenden die bestehende Mock-Infrastruktur (analog zu `SlidingTests.cs`):
- `MockLocomotionConfig` für Config-Werte
- `MockPlayerController` / `MockAnimationController` falls vorhanden
- Alternativ: Direkte Property-Prüfungen auf den State-Objekten

**Prüfe** die bestehenden `SlidingTests.cs` für das Test-Pattern:

```
Packages/Wiesenwischer.GameKit.CharacterController.Core/Tests/Runtime/SlidingTests.cs
```

## Verifikation

- [ ] `RollingTests.cs` existiert in `Tests/Runtime/`
- [ ] Mindestens 15 Tests wie oben definiert
- [ ] Tests nutzen konsistentes Pattern mit bestehenden Tests
- [ ] Alle Tests kompilieren
- [ ] Alle Tests bestehen (grün)

## Erwartete Dateien

```
Packages/Wiesenwischer.GameKit.CharacterController.Core/Tests/Runtime/
├── RollingTests.cs                ← NEU
├── SlidingTests.cs                ← Referenz für Pattern
```

---

→ Nächster Schritt: [22.7 Play Mode Verifikation](22.7-play-mode-verifikation.md)
