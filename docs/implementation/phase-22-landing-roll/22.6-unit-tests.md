# 22.6 Unit Tests

> **Commit:** `test(phase-22): 22.6 Rolling Unit Tests`
> **Branch:** `test/roll-tests`

---

## Ziel

Unit Tests für den PlayerRollingState und die erweiterte FallingState Landing-Logik.

---

## Anweisungen

### 1. Test-Datei erstellen

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Core/Tests/Runtime/RollingTests.cs`

### 2. Test-Cases

Basierend auf der Spezifikation (Kapitel 9.1):

```csharp
[TestFixture]
public class RollingTests
{
    // === RollingState Tests ===

    [Test]
    public void RollingState_Enter_SetsCorrectSpeedModifier()
    {
        // SpeedModifier = Config.RunSpeed * Config.RollSpeedModifier / Config.WalkSpeed
    }

    [Test]
    public void RollingState_Enter_DisablesSprint()
    {
        // ReusableData.SprintHeld = false nach Enter
    }

    [Test]
    public void RollingState_BlocksJumpInput()
    {
        // Jump-Input wird während Roll ignoriert
    }

    [Test]
    public void RollingState_TransitionsToMovement_WhenInputActive()
    {
        // → Walk/Run/Sprint nach Animation-Ende mit Input
    }

    [Test]
    public void RollingState_TransitionsToMediumStop_WhenNoInput()
    {
        // → MediumStop nach Animation-Ende ohne Input
    }

    [Test]
    public void RollingState_SetsCorrectRotation()
    {
        // Character rotiert in Input-Richtung bei Enter
    }

    // === FallingState Roll-Trigger Tests ===

    [Test]
    public void FallingState_TransitionsToRoll_WhenMovementInput()
    {
        // MovementInput-Modus: Movement-Input bei hartem Aufprall → Roll
    }

    [Test]
    public void FallingState_TransitionsToHardLand_WhenNoInput()
    {
        // Kein Input bei hartem Aufprall → HardLand (unverändert)
    }

    [Test]
    public void FallingState_TransitionsToRoll_WhenButtonPressed()
    {
        // ButtonPress-Modus: DashPressed bei hartem Aufprall → Roll
    }

    [Test]
    public void FallingState_NoRoll_WhenDisabled()
    {
        // RollEnabled = false → immer HardLand
    }

    [Test]
    public void FallingState_SoftLanding_UnchangedWithRoll()
    {
        // Niedriger Fall + Movement-Input → SoftLanding (nicht Roll)
    }
}
```

### 3. MockConfig erweitern

Falls nicht bereits in Schritt 22.2 geschehen, MockConfig in `RollingTests.cs` erstellen mit:
- `RollEnabled = true`
- `RollTriggerMode = RollTriggerMode.MovementInput`
- `RollSpeedModifier = 1.0f`

### 4. Test-Pattern

Orientiere dich am Pattern der bestehenden `SlidingTests.cs`:
- MockConfig implementiert `ILocomotionConfig`
- Mock-Objekte für Player, AnimationController, Motor
- Direkte State-Instanziierung und Methoden-Aufrufe

---

## Verifikation

- [ ] Alle 11 Tests kompilieren
- [ ] Alle Tests bestehen (grün)
- [ ] MockConfig hat alle Roll-relevanten Properties
- [ ] Keine Compiler-Warnings

---

## Erwartete Dateien

```
Packages/.../Tests/Runtime/RollingTests.cs   (NEU)
```

---

**Nächster Schritt:** [22.7 Play Mode Verifikation](22.7-play-mode-verifikation.md)
