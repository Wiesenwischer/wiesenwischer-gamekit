# 22.3 CharacterAnimationState.Roll + Animator-State

> **Commit:** `feat(phase-22): 22.3 Roll Animation-Integration`
> **Branch:** `feat/roll-animation-integration`

---

## Ziel

`CharacterAnimationState.Roll` zum Enum hinzufügen und alle Animation-Komponenten aktualisieren (TransitionConfig, AnimatorParameterBridge, AnimationWizard, Animator-Controller).

---

## Anweisungen

### 1. CharacterAnimationState erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Core/Runtime/Core/Animation/IAnimationController.cs`

```csharp
public enum CharacterAnimationState
{
    Locomotion,
    Jump,
    Fall,
    SoftLand,
    HardLand,
    Roll,        // ← NEU (nach HardLand, Landing-States zusammen)
    LightStop,
    MediumStop,
    HardStop,
    Slide,
}
```

### 2. AnimationParameters erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Animation/Runtime/Core/AnimationParameters.cs`

```csharp
public static readonly int RollStateHash = Animator.StringToHash("Roll");
```

### 3. AnimationTransitionConfig erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Animation/Runtime/Core/AnimationTransitionConfig.cs`

Neues SerializeField:
```csharp
[SerializeField] private float _rollTransitionDuration = 0.1f;
public float RollTransitionDuration => _rollTransitionDuration;
```

In `GetTransitionDuration()` switch:
```csharp
case CharacterAnimationState.Roll: return _rollTransitionDuration;
```

### 4. AnimatorParameterBridge erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Animation/Runtime/Core/AnimatorParameterBridge.cs`

In `PlayState()` switch:
```csharp
case CharacterAnimationState.Roll: hash = AnimationParameters.RollStateHash; break;
```

In Debug-State-Name Erkennung:
```csharp
else if (stateInfo.IsName("Roll")) stateName = "Roll";
```

In Default-Transition-Duration Fallback:
```csharp
case CharacterAnimationState.Roll: return 0.1f;
```

### 5. AnimationWizard erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Animation/Editor/AnimationWizard.cs`

Neues Feld für Roll-Animation-Slot:
```csharp
private GameObject _animRoll;
```

Im Airborne+Slide Foldout:
```csharp
_animRoll = FbxSlot("Roll", _animRoll);
```

In `LoadDefaults()`:
```csharp
_animRoll = LoadFbxAsset("Anim_Roll");
```

In `PerformAnimationSetup()` — Roll-State im Animator erstellen (analog zu den anderen States).

### 6. AirborneStatesCreator erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Animation/Editor/AirborneStatesCreator.cs`

Roll-State hinzufügen (One-Shot, kein Loop, mit AllowExit-Pattern wie HardLand).

---

## Verifikation

- [ ] `CharacterAnimationState.Roll` existiert im Enum
- [ ] `AnimationParameters.RollStateHash` ist definiert
- [ ] `AnimationTransitionConfig` hat Roll-Transition-Duration (0.1s)
- [ ] `AnimatorParameterBridge.PlayState()` unterstützt Roll
- [ ] AnimationWizard zeigt Roll-Slot
- [ ] Kompilierung fehlerfrei

---

## Erwartete Dateien

```
Packages/.../Core/Runtime/Core/Animation/IAnimationController.cs       (GEÄNDERT)
Packages/.../Animation/Runtime/Core/AnimationParameters.cs             (GEÄNDERT)
Packages/.../Animation/Runtime/Core/AnimationTransitionConfig.cs       (GEÄNDERT)
Packages/.../Animation/Runtime/Core/AnimatorParameterBridge.cs         (GEÄNDERT)
Packages/.../Animation/Editor/AnimationWizard.cs                       (GEÄNDERT)
Packages/.../Animation/Editor/AirborneStatesCreator.cs                 (GEÄNDERT)
```

---

**Nächster Schritt:** [22.4 PlayerRollingState](22.4-rolling-state.md)
