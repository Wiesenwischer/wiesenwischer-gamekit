# 23.4 CharacterAnimationState.Crouch + Animator

> **Commit:** `feat(phase-23): 23.4 Crouch Animation-Integration`
> **Branch:** `feat/crouch-animation-integration`

---

## Ziel

`CharacterAnimationState.Crouch` zum Enum hinzufügen und alle Animation-Komponenten aktualisieren.

---

## Anweisungen

### 1. CharacterAnimationState erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Core/Runtime/Core/Animation/IAnimationController.cs`

```csharp
public enum CharacterAnimationState
{
    Locomotion,
    Jump,
    Fall,
    SoftLand,
    HardLand,
    Roll,        // Phase 22 (falls bereits vorhanden)
    LightStop,
    MediumStop,
    HardStop,
    Slide,
    Crouch,      // ← NEU
}
```

### 2. AnimationParameters erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Animation/Runtime/Core/AnimationParameters.cs`

```csharp
public static readonly int CrouchStateHash = Animator.StringToHash("Crouch");
```

### 3. AnimationTransitionConfig erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Animation/Runtime/Core/AnimationTransitionConfig.cs`

```csharp
[SerializeField] private float _crouchTransitionDuration = 0.25f;
public float CrouchTransitionDuration => _crouchTransitionDuration;
```

In `GetTransitionDuration()`:
```csharp
case CharacterAnimationState.Crouch: return _crouchTransitionDuration;
```

### 4. AnimatorParameterBridge erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Animation/Runtime/Core/AnimatorParameterBridge.cs`

In `PlayState()` switch:
```csharp
case CharacterAnimationState.Crouch: hash = AnimationParameters.CrouchStateHash; break;
```

In Debug-State-Name:
```csharp
else if (stateInfo.IsName("Crouch")) stateName = "Crouch";
```

In Default-Transition-Duration Fallback:
```csharp
case CharacterAnimationState.Crouch: return 0.25f;
```

### 5. AnimationWizard erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Animation/Editor/AnimationWizard.cs`

Neue Felder:
```csharp
private GameObject _animCrouchIdle;
private GameObject _animCrouchWalk;
```

Neuer Foldout "Crouching":
```csharp
_foldCrouch = EditorGUILayout.Foldout(_foldCrouch, "Crouching", true, EditorStyles.foldoutHeader);
if (_foldCrouch)
{
    EditorGUI.indentLevel++;
    _animCrouchIdle = FbxSlot("Crouch Idle", _animCrouchIdle);
    _animCrouchWalk = FbxSlot("Crouch Walk", _animCrouchWalk);
    EditorGUI.indentLevel--;
}
```

In `LoadDefaults()`:
```csharp
_animCrouchIdle = LoadFbxAsset("Anim_CrouchIdle");
_animCrouchWalk = LoadFbxAsset("Anim_CrouchWalk");
```

In `PerformAnimationSetup()` — Crouch Blend Tree im Animator erstellen:
- State "Crouch" mit 1D Blend Tree
- Parameter: `Speed`
- Threshold 0 → Crouch Idle
- Threshold 1 → Crouch Walk

### 6. Animator-Controller

Der AnimationWizard erstellt den Crouch-State automatisch. Falls manuell:
- State "Crouch" mit Blend Tree (Speed: 0=Idle, >0=Walk)
- Transition: Any State → Crouch (Condition: AnimationState == Crouch)
- Transition: Crouch → Locomotion (Condition: AnimationState == Locomotion)

---

## Verifikation

- [ ] `CharacterAnimationState.Crouch` existiert
- [ ] `AnimationParameters.CrouchStateHash` ist definiert
- [ ] `AnimationTransitionConfig` hat Crouch-Duration (0.25s)
- [ ] `AnimatorParameterBridge.PlayState()` unterstützt Crouch
- [ ] AnimationWizard zeigt Crouch Idle + Crouch Walk Slots
- [ ] Kompilierung fehlerfrei

---

## Erwartete Dateien

```
Packages/.../Core/Runtime/Core/Animation/IAnimationController.cs       (GEÄNDERT)
Packages/.../Animation/Runtime/Core/AnimationParameters.cs             (GEÄNDERT)
Packages/.../Animation/Runtime/Core/AnimationTransitionConfig.cs       (GEÄNDERT)
Packages/.../Animation/Runtime/Core/AnimatorParameterBridge.cs         (GEÄNDERT)
Packages/.../Animation/Editor/AnimationWizard.cs                       (GEÄNDERT)
```

---

**Nächster Schritt:** [23.5 Capsule-Höhen-Transition](23.5-capsule-transition.md)
