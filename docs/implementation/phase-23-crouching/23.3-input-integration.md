# 23.3 Input-Integration (CrouchTogglePressed)

> **Commit:** `feat(phase-23): 23.3 Crouch Input-Integration`
> **Branch:** `feat/crouch-input`

---

## Ziel

`CrouchTogglePressed` in der Input-Pipeline verdrahten: `IMovementInputProvider` → `PlayerInputProvider` → `PlayerStateReusableData`.

---

## Anweisungen

### 1. IMovementInputProvider erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Core/Runtime/Core/Input/IMovementInputProvider.cs`

Neue Property:

```csharp
/// <summary>Ob Crouch-Toggle gedrückt wurde (einmalig pro Press).</summary>
bool CrouchTogglePressed { get; }
```

### 2. PlayerInputProvider erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Core/Runtime/Core/Input/PlayerInputProvider.cs`

Die Crouch Input Action ist bereits im `InputSystem_Actions.inputactions` konfiguriert (C-Taste). Nur die Verdrahtung fehlt.

**Neues Feld:**
```csharp
private InputAction _crouchToggleAction;
private bool _crouchToggleStarted;
```

**In der Initialisierung** (wo andere Actions gefunden werden):
```csharp
_crouchToggleAction = _actionMap.FindAction("Crouch");
```

**Callbacks verdrahten** (wie `WalkTogglePressed`):
```csharp
_crouchToggleAction.started += ctx => _crouchToggleStarted = true;
```

**Property implementieren:**
```csharp
public bool CrouchTogglePressed
{
    get
    {
        bool val = _crouchToggleStarted;
        _crouchToggleStarted = false;
        return val;
    }
}
```

**In Enable/Disable:**
```csharp
_crouchToggleAction?.Enable();
// bzw. _crouchToggleAction?.Disable();
```

**In `CreateSnapshot()`:** CrouchTogglePressed in Snapshot aufnehmen (falls vorhanden).

> **Hinweis:** Das Pattern ist identisch zu `WalkTogglePressed`. Orientiere dich daran.

### 3. PlayerStateReusableData erweitern

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Core/Runtime/Core/Data/PlayerStateReusableData.cs`

Neue Properties:

```csharp
/// <summary>Crouch-Toggle Input (einmalig pro Frame).</summary>
public bool CrouchTogglePressed { get; set; }

/// <summary>Ob der Character aktuell im Crouch-State ist (für Persistenz).</summary>
public bool IsCrouching { get; set; }
```

### 4. Input-Weiterleitung prüfen

In der Stelle wo `ReusableData` aus dem `IMovementInputProvider` befüllt wird (z.B. `HandleInput()` in einem State oder `PlayerController`), muss `CrouchTogglePressed` weitergeleitet werden:

```csharp
ReusableData.CrouchTogglePressed = InputProvider.CrouchTogglePressed;
```

Prüfe das bestehende Pattern für `WalkTogglePressed` und `DashPressed` um die exakte Stelle zu finden.

---

## Verifikation

- [ ] `IMovementInputProvider.CrouchTogglePressed` existiert
- [ ] `PlayerInputProvider` verdrahtet Crouch-Action auf C-Taste
- [ ] `CrouchTogglePressed` feuert nur einmal pro Tastendruck (Toggle, nicht Hold)
- [ ] `PlayerStateReusableData` hat `CrouchTogglePressed` und `IsCrouching`
- [ ] Input-Weiterleitung zu ReusableData funktioniert
- [ ] Kompilierung fehlerfrei

---

## Erwartete Dateien

```
Packages/.../Runtime/Core/Input/IMovementInputProvider.cs    (GEÄNDERT)
Packages/.../Runtime/Core/Input/PlayerInputProvider.cs       (GEÄNDERT)
Packages/.../Runtime/Core/Data/PlayerStateReusableData.cs    (GEÄNDERT)
```

---

**Nächster Schritt:** [23.4 Animation-Integration](23.4-animation-integration.md)
