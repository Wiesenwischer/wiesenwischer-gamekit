# 23.8 Unit Tests

> **Commit:** `test(phase-23): 23.8 Crouching Unit Tests`
> **Branch:** `test/crouch-tests`

---

## Ziel

Unit Tests für den PlayerCrouchingState, Capsule-Transition und Input-Integration.

---

## Anweisungen

### 1. Test-Datei erstellen

**Datei:** `Packages/Wiesenwischer.GameKit.CharacterController.Core/Tests/Runtime/CrouchingTests.cs`

### 2. Test-Cases

```csharp
[TestFixture]
public class CrouchingTests
{
    // === CrouchingState Entry/Exit ===

    [Test]
    public void CrouchingState_EntersOnToggle()
    {
        // C-Taste → Crouch aktiviert
    }

    [Test]
    public void CrouchingState_ExitsOnToggle()
    {
        // C-Taste erneut → Crouch deaktiviert (wenn CanStandUp)
    }

    [Test]
    public void CrouchingState_CannotStandUpUnderCeiling()
    {
        // CanStandUp() = false → bleibt im Crouch
    }

    // === Movement ===

    [Test]
    public void CrouchingState_SpeedIsReduced()
    {
        // MovementSpeedModifier = CrouchSpeed / WalkSpeed
    }

    [Test]
    public void CrouchingState_IdleSpeedIsZero()
    {
        // Ohne Movement-Input: SpeedModifier = 0
    }

    [Test]
    public void CrouchingState_MovementWorks()
    {
        // Bewegung mit reduzierter Speed funktioniert
    }

    // === Capsule ===

    [Test]
    public void CrouchingState_CapsuleHeightReduced()
    {
        // Capsule-Höhe = CrouchHeight bei Entry
    }

    [Test]
    public void CrouchingState_CapsuleHeightRestoredOnExit()
    {
        // Capsule-Höhe zurück auf StandingHeight bei Exit
    }

    // === Transitions ===

    [Test]
    public void CrouchingState_SprintExitsCrouch()
    {
        // Sprint-Input beendet Crouch (wenn CanSprintFromCrouch)
    }

    [Test]
    public void CrouchingState_JumpExitsCrouch()
    {
        // Jump aus Crouch steht auf + springt
    }

    [Test]
    public void CrouchingState_FallingExitsCrouch()
    {
        // Über Kante → Aufstehen + Fallen
    }

    // === Toggle-Verhalten ===

    [Test]
    public void CrouchingState_ToggleIsOneShot()
    {
        // Toggle feuert nur einmal pro Tastendruck
    }
}
```

### 3. MockConfig erweitern

MockConfig in `CrouchingTests.cs` mit allen Crouch-Properties:
- `CrouchHeight = 1.2f`
- `StandingHeight = 2.0f`
- `CrouchSpeed = 2.5f`
- `CrouchAcceleration = 8.0f`
- `CrouchDeceleration = 10.0f`
- `CrouchTransitionDuration = 0.25f`
- `CrouchHeadClearanceMargin = 0.1f`
- `CanJumpFromCrouch = true`
- `CanSprintFromCrouch = true`
- `CrouchStepHeight = 0.2f`

### 4. Test-Pattern

Orientiere dich am Pattern der bestehenden `SlidingTests.cs`:
- MockConfig implementiert `ILocomotionConfig`
- Mock-Objekte für Player, AnimationController, Motor, Locomotion
- Direkte State-Instanziierung und Methoden-Aufrufe

---

## Verifikation

- [ ] Alle 12 Tests kompilieren
- [ ] Alle Tests bestehen (grün)
- [ ] MockConfig hat alle Crouch-relevanten Properties
- [ ] Keine Compiler-Warnings

---

## Erwartete Dateien

```
Packages/.../Tests/Runtime/CrouchingTests.cs   (NEU)
```

---

**Nächster Schritt:** [23.9 Play Mode Verifikation](23.9-play-mode-verifikation.md)
