# 24.1 Body-Offset darf leicht nach oben

> **Commit-Message:** `fix(phase-24): 24.1 Body-Offset nach oben erlauben`
> **Branch:** `fix/footik-body-offset-up`
> **Spec-Referenz:** [FootIK Verbesserungen — Fix 1](../../specs/FootIK_Verbesserungen_Spezifikation.md#fix-1-body-offset-darf-leicht-nach-oben)

---

## Ziel

Den Body-Offset so anpassen, dass der Body den IK-adjustierten Füßen auch leicht nach oben folgen kann. Aktuell wird der Body-Offset auf `≤ 0` geclampt — der Body kann sich nie nach oben bewegen, obwohl die Füße durch `_footOffset` angehoben werden.

---

## Problemanalyse

**Aktuelle Zeile 139 in `FootIK.cs`:**
```csharp
targetBodyOffset = Mathf.Min(targetBodyOffset, 0f); // Nur nach unten
```

**Was passiert auf flachem Boden:**
1. Raycast trifft bei `hit.point.y ≈ 0.0`
2. IK-Target: `hit.point.y + _footOffset = 0.04` (4cm über Boden)
3. Animation hat Fuß bei ca. `0.0`
4. Delta = `+0.04` → Body-Offset wird auf `0` geclampt
5. Fuß wird 4cm angehoben, Body bleibt → Knie beugt sich

---

## Änderungen

### 1. Neuer Parameter `_maxBodyUpOffset`

Im `[Header("Adjustments")]` Bereich, nach `_maxFootAdjustment`:

```csharp
[Tooltip("Maximaler Body-Offset nach oben (kompensiert footOffset).")]
[SerializeField] private float _maxBodyUpOffset = 0.05f;
```

**Warum 5cm Default?** Der Wert muss den `_footOffset` (4cm) kompensieren können, aber nicht mehr. 5cm gibt etwas Spielraum. Höhere Werte würden den Character "schweben" lassen.

### 2. Body-Offset Clamping ändern

In `PrepareIK()`, Zeile 139 ersetzen:

```csharp
// VORHER:
targetBodyOffset = Mathf.Min(targetBodyOffset, 0f); // Nur nach unten

// NACHHER:
targetBodyOffset = Mathf.Clamp(targetBodyOffset, -_maxFootAdjustment, _maxBodyUpOffset);
```

Der Offset wird jetzt zwischen `-_maxFootAdjustment` (max. nach unten) und `+_maxBodyUpOffset` (max. nach oben) begrenzt.

---

## Erwartetes Verhalten

| Szenario | Vorher | Nachher |
|----------|--------|---------|
| Flacher Boden, Idle | Body-Offset = 0, Füße +4cm → Knie gebeugt | Body-Offset = +4cm, Füße +4cm → Beine gerade |
| Kante (ein Fuß hängt) | Body-Offset negativ (korrekt) | Body-Offset negativ (unverändert) |
| Treppe | Body-Offset negativ (niedrigerer Fuß bestimmt) | Unverändert (niedrigerer Fuß ist negativ) |

---

## Verifikation

- [ ] Compiler-Fehler prüfen
- [ ] `_maxBodyUpOffset` erscheint im Inspector unter "Adjustments"
- [ ] Default-Wert ist 0.05 im Inspector

---

## Erwartete Dateien

| Datei | Änderung |
|-------|----------|
| `FootIK.cs` | Neues Feld `_maxBodyUpOffset`, Clamp statt Min |

---

→ Nächster Schritt: [24.2 Terrain-Varianz IK-Weight](24.2-terrain-variance.md)
