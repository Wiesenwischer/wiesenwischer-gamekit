# 3.4 Test-Szene & Verifikation

**Commit:** `test(phase-3): 3.4 Test-Szene und Verifikation`
**Branch:** `test/animation-integration`

---

## Ziel

Eine Test-Szene einrichten, alle Animation-Übergänge verifizieren und Parameter-Werte im Animator-Fenster live beobachten. Sicherstellen, dass alle Locomotion- und Airborne-Animationen korrekt mit der State Machine zusammenarbeiten.

---

## 1. Test-Szene einrichten

### Szene erstellen

1. Neue Szene: `Assets/Scenes/AnimationTestScene.unity`
2. Boden-Plane (100x100) mit Collider
3. Erhöhte Plattform (für Fall-Tests, Höhe ~5m und ~15m)
4. Rampe/Slope (für Sliding-Tests)
5. Directional Light + Skybox

### Player platzieren

1. Player Prefab (aus Schritt 3.3) in die Szene ziehen
2. Position: `(0, 1, 0)` (leicht über dem Boden)
3. Input Provider zuweisen (falls nicht automatisch)

### Camera

1. Einfache Follow-Camera oder Cinemachine FreeLook
2. Target: Player-Transform

---

## 2. Animations-Checkliste

### Locomotion (Blend Tree, kontinuierlich)

| Test | Aktion | Erwartung | Animator-Wert |
|------|--------|-----------|---------------|
| Idle | Keine Eingabe | Idle-Animation | Speed ≈ 0.0 |
| Walk | Stick leicht / Walk-Toggle | Walk-Animation | Speed ≈ 0.5 |
| Run | Stick voll | Run-Animation | Speed ≈ 1.0 |
| Sprint | Stick voll + Sprint | Sprint-Animation | Speed ≈ 1.5 |
| Walk→Run | Stick-Intensität erhöhen | Fließender Übergang | Speed 0.5→1.0 |
| Run→Idle | Stick loslassen | Abbremsen, dann Idle | Speed 1.0→0.0 |

### Airborne (Trigger-basiert)

| Test | Aktion | Erwartung | Animator-Wert |
|------|--------|-----------|---------------|
| Jump | Jump drücken | Jump-Animation | Jump-Trigger, VertVel > 0 |
| Fall | Von Kante laufen | Fall-Animation | IsGrounded=false, VertVel < 0 |
| Soft Land | Aus niedriger Höhe fallen | Kurze Landung, sofort weiter | Land-Trigger, HardLanding=false |
| Hard Land | Aus großer Höhe fallen | Längere Recovery-Animation | Land-Trigger, HardLanding=true |
| Jump→Fall | Jump, Scheitelpunkt | Übergang Jump→Fall | VertVel: positiv→negativ |
| Jump Cut | Jump loslassen früh | Kürzerer Sprung | VertVel schneller negativ |

### Kombinations-Tests

| Test | Aktion | Erwartung |
|------|--------|-----------|
| Run + Jump | Laufen und springen | Jump-Anim, dann Fall, dann Land, dann weiter laufen |
| Sprint + Jump | Sprinten und springen | Gleich, mit höherem Speed-Wert |
| Idle + Jump | Stehen und springen | Jump von Idle, Land in Idle |
| Hard Land Recovery | Aus ~15m fallen | Hard-Land-Animation, Movement blockiert für ~0.4s |
| Hard Land + Jump Buffer | Bei Hard-Land Jump drücken | Nach Recovery sofort Jump |

---

## 3. Live-Debugging im Animator-Fenster

### Animator-Fenster öffnen

1. `Window > Animation > Animator`
2. Im Play Mode das Player-Objekt auswählen
3. Die aktiven States werden blau hervorgehoben

### Parameter beobachten

Im Animator-Fenster unten links die Parameter-Liste prüfen:

| Parameter | Erwarteter Bereich | Was prüfen |
|-----------|-------------------|------------|
| Speed | 0.0 – 1.5 | Smooth Damping, kein Springen |
| IsGrounded | true/false | Wechselt bei Jump/Fall korrekt |
| VerticalVelocity | -50 ... +10 | Smooth, folgt der Physik |
| Jump | Trigger | Feuert einmal bei Sprung |
| Land | Trigger | Feuert einmal bei Landung |
| HardLanding | true/false | true nur bei hohem Fall |

### Layer-Weights prüfen

| Layer | Weight | Erwartung |
|-------|--------|-----------|
| Base Movement | 1.0 | Immer aktiv |
| Abilities | 0.0 | Inaktiv (wird in Phase 4 genutzt) |
| Status | 0.0 | Inaktiv (wird in Phase 4+ genutzt) |

---

## 4. Häufige Probleme & Lösungen

| Problem | Ursache | Lösung |
|---------|---------|--------|
| Character gleitet ohne Animation | Apply Root Motion = true | Root Motion deaktivieren |
| Character bewegt sich doppelt | Root Motion aktiv | Root Motion deaktivieren |
| Kein Übergang Walk→Run | Blend Tree Thresholds falsch | Prüfe Thresholds: 0, 0.5, 1.0, 1.5 |
| Jump-Animation spielt nicht | Trigger nicht verbunden | State prüfen: Hat Jump-Transition `Jump`-Condition? |
| Speed springt statt smooth | DampTime = 0 | `_speedDampTime = 0.1f` in Bridge |
| Character fällt durch Boden | Collider fehlt | CharacterMotor + Collider prüfen |
| "Kein IAnimationController" Warning | Bridge nicht auf Model-Child | AnimatorParameterBridge auf Animator-GameObject |
| Animation friert ein | Animator Culling | Culling Mode → `Always Animate` zum Testen |

---

## 5. Parameter-Tuning

Falls Animationen nicht gut aussehen, diese Werte in der `AnimatorParameterBridge` anpassen:

| Parameter | Default | Anpassen wenn... |
|-----------|---------|-------------------|
| `_speedDampTime` | 0.1s | Übergänge zu abrupt (erhöhen) oder zu träge (verringern) |
| `_verticalVelocityDampTime` | 0.05s | Fall-Übergang zu langsam (verringern) |

Und in den Animator-Transitions:
| Einstellung | Empfehlung | Anpassen wenn... |
|------------|------------|-------------------|
| Transition Duration | 0.1–0.25s | Übergänge zu hart (erhöhen) oder zu weich (verringern) |
| Has Exit Time | false (Triggers) | Animation muss erst fertig spielen → true |
| Interruption Source | Current State | Für responsive Übergänge |

---

## Verifikation

### Animations-Tests bestanden:
- [ ] Idle-Animation spielt bei Stillstand
- [ ] Walk/Run/Sprint mit fließenden Übergängen
- [ ] Jump-Animation beim Springen
- [ ] Fall-Animation beim Fallen
- [ ] Soft-Landing bei niedriger Fallhöhe
- [ ] Hard-Landing bei hoher Fallhöhe mit Recovery
- [ ] Jump Buffer funktioniert während Hard-Landing-Recovery
- [ ] Speed-Damping sorgt für smooth Übergänge
- [ ] Kein Root Motion (Bewegung nur durch Motor)

### Technische Prüfung:
- [ ] Keine Compiler-Fehler in allen Packages
- [ ] Keine Runtime-Errors in der Console
- [ ] Animator-Parameter ändern sich korrekt im Animator-Fenster
- [ ] Layer Weights korrekt (Base=1, Abilities=0, Status=0)

### Compiler prüfen

```bash
powershell -Command "Get-Content 'C:\Users\marcu\AppData\Local\Unity\Editor\Editor.log' -Tail 100 | Select-String -Pattern 'error|CS\d{4}'"
```

---

## Phase 3 abgeschlossen!

Nach erfolgreichem Test aller Animationen ist die Animation-Pipeline vollständig integriert:

- ✅ Phase 1: Assets und Package-Struktur
- ✅ Phase 2: Animator Controller, Blend Trees, Bridge
- ✅ Phase 3: Integration mit Character Controller, animiertes Prefab

**Der Character kann jetzt animiert laufen, springen und landen.**

---

## Nächste Phasen

- [Phase 4: Ability System](../phase-4-ability-system/README.md) — Abilities nutzen den Ability-Layer (Layer 1) des Animators
- [Phase 7: IK System](../phase-7-ik-system/README.md) — Inverse Kinematics baut auf dem Animator auf
