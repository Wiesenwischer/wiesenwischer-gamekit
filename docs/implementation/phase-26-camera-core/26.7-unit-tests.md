# 26.7 Unit Tests

> **Commit:** `feat(phase-26): 26.7 Unit Tests`

---

## Ziel

Unit Tests für alle neuen Camera Core Komponenten. Sicherstellen, dass die Grundtypen, PivotRig, CameraAnchor und CameraInputPipeline korrekt funktionieren.

---

## Test-Projekt

**`Packages/Wiesenwischer.GameKit.Camera.Core/Tests/Wiesenwischer.GameKit.Camera.Core.Tests.asmdef`**
```json
{
  "name": "Wiesenwischer.GameKit.Camera.Core.Tests",
  "rootNamespace": "Wiesenwischer.GameKit.Camera.Tests",
  "references": [
    "Wiesenwischer.GameKit.Camera.Core.Runtime",
    "UnityEngine.TestRunner",
    "UnityEditor.TestRunner"
  ],
  "includePlatforms": ["Editor"],
  "optionalUnityReferences": ["TestAssemblies"],
  "defineConstraints": ["UNITY_INCLUDE_TESTS"]
}
```

---

## Test-Klassen

### 1. CameraStateTests

```
- Default_ReturnsExpectedValues
  → CameraState.Default hat Yaw=0, Pitch=0, Distance=5, FOV=60

- Struct_IsValueType
  → CameraState ist ein Struct (Wertsemantik)
```

### 2. PivotRigTests

```
- EnsureHierarchy_CreatesAllPivots
  → Nach EnsureHierarchy() existieren YawPivot, PitchPivot, OffsetPivot, Camera

- ApplyState_SetsYawRotation
  → Yaw=90 → YawPivot.localEulerAngles.y ≈ 90

- ApplyState_SetsPitchRotation
  → Pitch=-30 → PitchPivot.localEulerAngles.x ≈ 330 (= -30)

- ApplyState_SetsDistance
  → Distance=8 → Camera.localPosition.z ≈ -8

- ApplyState_SetsShoulderOffset
  → ShoulderOffset=(0.5, 0, 0) → OffsetPivot.localPosition.x ≈ 0.5

- ApplyState_SetsAnchorPosition
  → anchorPosition=(1,2,3) → Root.position ≈ (1,2,3)

- GetCameraForward_ReturnsCorrectDirection
  → Nach Yaw=0, Pitch=0 → Forward ≈ (0,0,1)
```

### 3. CameraAnchorTests

```
- SnapToTarget_SetsPositionImmediately
  → AnchorPosition == FollowTarget.position + Offset

- SnapToTarget_ResetsVelocity
  → Nach Snap kein SmoothDamp-Nachlauf

- UpdateAnchor_WithoutTarget_DoesNotThrow
  → FollowTarget = null → kein Fehler

- UpdateAnchor_FollowsTarget_Smoothed
  → Nach mehreren Updates nähert sich AnchorPosition dem Target

- UpdateAnchor_YSmoothing_SlowerThanXZ
  → Bei gleicher Target-Distanz erreicht Y langsamer als XZ
```

### 4. CameraInputPipelineTests

```
- ProcessInput_WithoutActions_ReturnsZero
  → Keine InputActions → CameraInputState ist leer

- Deadzone_FiltersSmallInput
  → Input < Deadzone → Output = 0

- Deadzone_PassesLargeInput
  → Input > Deadzone → Output ≠ 0

- Acceleration_AmplifiesLargeInput
  → Bei Exponent > 1 wird großer Input überproportional verstärkt

- Acceleration_ReducesSmallInput
  → Bei Exponent > 1 wird kleiner Input unterproportional abgeschwächt

- InvertY_NegatesLookY
  → InvertY = true → LookY hat umgekehrtes Vorzeichen
```

---

## Hinweise

- Input-Pipeline-Tests brauchen ggf. Mock-InputActions oder testen nur die Filter-Methoden isoliert
- PivotRig-Tests sind Play Mode Tests (brauchen GameObjects + Transforms)
- CameraAnchor-Tests sind Play Mode Tests
- CameraBrain-Integration wird manuell in Play Mode verifiziert (Schritt 26.6)

---

## Akzeptanzkriterien

- [ ] Alle Tests kompilieren fehlerfrei
- [ ] Alle Tests sind grün
- [ ] PivotRig-Hierarchie wird korrekt getestet
- [ ] CameraAnchor Smoothing-Verhalten getestet
- [ ] Input Pipeline Filter isoliert testbar
