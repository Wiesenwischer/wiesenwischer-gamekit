# BDO-Style Combat Architecture -- Advanced Layers (Continuation)

This document summarizes the **new architectural layers** discussed
AFTER the previous markdown. It focuses on advanced AAA combat
architecture patterns inspired by Black Desert Online (BDO) and designed
for MMO-ready action combat systems.

------------------------------------------------------------------------

# 1. Combat Tags / Combat Layers

## Purpose

Combat Tags solve the "condition explosion" problem that happens when
states and transitions grow too complex.

Instead of:

    if currentState == LightAttack AND not stunned AND not airborne ...

We use:

    Tag-based context checks.

------------------------------------------------------------------------

## Concept

Character has a dynamic set of tags:

Examples:

-   Attacking
-   SuperArmor
-   ForwardGuard
-   Airborne
-   Cancelable
-   Blocking

------------------------------------------------------------------------

## Benefits

-   Modular combat behavior
-   Easy extensibility
-   Cleaner transitions
-   Networking validation simplified

Server validation example:

    if HasTag("SuperArmor"):
        ignore stagger

------------------------------------------------------------------------

## Implementation Idea

    class CombatTagContainer
    {
        HashSet<CombatTag> tags;
    }

Tags can be:

-   permanent
-   phase-based
-   time-based

------------------------------------------------------------------------

# 2. Directional Combat / Input Context System

## Core Principle

Combat selection is NOT:

    Input -> Attack

Instead:

    Input + Context -> AttackNode

------------------------------------------------------------------------

## Input Context

Includes:

-   movement direction
-   camera orientation
-   velocity
-   target lock
-   grounded state
-   active tags

------------------------------------------------------------------------

## Direction Classification

Movement categorized relative to camera:

-   Forward
-   Backward
-   Left
-   Right
-   Neutral

Example:

    dot(cameraForward, movementDirection)

------------------------------------------------------------------------

## Why Important

-   Few inputs produce many attacks
-   Enables deep combat systems
-   MMO deterministic validation possible

------------------------------------------------------------------------

# 3. Cancel System + Priority Layers

## Problem

Multiple inputs compete during attacks:

-   dodge
-   skill
-   heavy attack

Which wins?

------------------------------------------------------------------------

## Solution: Priority System

Each action has a priority level.

Example:

-   LightAttack = 10
-   HeavyAttack = 15
-   Skill = 20
-   Dodge = 100
-   Stun = 300

Transition rule:

    newPriority >= currentPriority
    AND required cancel tags exist

------------------------------------------------------------------------

## Phase-Based Cancels

Cancel permissions depend on attack phase:

-   Startup → usually no cancel
-   Active → dodge cancel allowed
-   Recovery → skill cancel allowed

------------------------------------------------------------------------

# 4. Attack Phase System (Frame Authority)

## Purpose

Ensures deterministic timing for:

-   hit detection
-   cancels
-   motion impulses
-   armor states

------------------------------------------------------------------------

## Recommended Phases

-   Enter
-   Startup
-   PreActive
-   Active (Hit Window)
-   PostActive
-   Recovery
-   Exit

------------------------------------------------------------------------

## Key Principle

Combat timeline controls animation --- NOT the other way around.

Avoid animation events as authority.

------------------------------------------------------------------------

# 5. Motion Authority Layer (Animation ⇄ Motor Sync)

## Core Problem

Animation and motor movement must feel unified without using root
motion.

------------------------------------------------------------------------

## Motion Authority Concept

Animation provides:

-   motion intent

Motor applies:

-   final movement

------------------------------------------------------------------------

## Movement Profiles

Per attack phase:

-   forward impulse
-   rotation assist
-   movement lock
-   velocity modifier

------------------------------------------------------------------------

## Example

    OnPhaseEnter(Active):
        motor.AddImpulse(forward * value)

------------------------------------------------------------------------

## Advanced Tip

Use curve-based impulses for realistic momentum.

------------------------------------------------------------------------

# 6. Complete Architecture Overview

    CharacterMotor
    CharacterStateMachine
    CombatController
        ├ ActionGraph
        ├ CombatTags
        ├ DirectionalContext
        ├ PriorityCancelSystem
        ├ PhaseAuthoritySystem
        └ MotionAuthorityLayer

------------------------------------------------------------------------

# NEXT STEP

Next planned topic:

Impact / Hit Feedback Stack

This layer heavily influences perceived combat quality.
