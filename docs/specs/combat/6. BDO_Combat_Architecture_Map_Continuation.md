# BDO-Style Combat -- Architecture Map (Continuation)

This document summarizes the **new content since the last markdown** and
provides a clear "mental map" of how AAA action combat systems
(BDO-style) are structured.

Goal: Enable implementation without mixing responsibilities and without
refactors later.

------------------------------------------------------------------------

# 1. Why an Architecture Map Matters

BDO-like combat is not "one system". It is a stack of layered systems
with strict responsibility boundaries.

If responsibilities mix (e.g., Animator becomes the brain), the system
becomes:

-   hard to extend
-   hard to debug
-   impossible to scale (especially for MMO)

------------------------------------------------------------------------

# 2. High-Level Architecture Overview

Core flow:

INPUT LAYER ↓ Combat Brain (CombatController) ↓ Action Graph ↓ Phase
Authority ↓ Motion Authority ↓ Character Motor ↓ Animation Layer ↓
Impact System

Cross-cutting systems:

-   Combat Tags
-   Priority / Cancel System
-   Directional Context

------------------------------------------------------------------------

# 3. Layer Responsibilities (AAA Separation)

## 3.1 Input Layer (Input → Intent)

Purpose:

-   collect raw player input
-   convert it into gameplay intents

Example:

LMB pressed + movement forward → CombatIntent.AttackLight

Important:

-   No combo logic
-   No hit logic
-   No animation logic

------------------------------------------------------------------------

## 3.2 Combat Brain (CombatController)

The authority system.

Handles:

-   current active action node
-   input buffer
-   transition selection
-   enforcing priorities and cancels

Rule:

CombatController decides what happens. Animator does not decide.

------------------------------------------------------------------------

## 3.3 Action Graph (Actions + Transitions)

Structure:

-   Nodes = actions / attacks
-   Edges = possible transitions

Example:

Light1 → Light2 → Heavy → DodgeCancel

Why graph instead of linear chain:

-   combos
-   directional variants
-   cancels
-   skills without exponential logic explosion.

------------------------------------------------------------------------

## 3.4 Phase Authority (Attack Timeline)

Each action has phases:

-   Startup
-   Active (Hit Window)
-   Recovery

Phase authority controls:

-   hit windows
-   cancel windows
-   movement constraints
-   when tags are applied

Key principle:

Combat timeline is authoritative; animation follows.

------------------------------------------------------------------------

## 3.5 Motion Authority (Animation ⇄ Motor Sync)

Goal:

-   AAA feel (weight + momentum)
-   MMO safe (no root motion authority)

Concept:

-   animation provides motion intent
-   motor applies final movement

Example:

OnActivePhase: motor.AddImpulse(forward \* value)

------------------------------------------------------------------------

## 3.6 Character Motor

Responsible for:

-   collisions
-   kinematic movement resolution
-   physics integration
-   final movement output

Important:

Motor must NOT contain combat decisions.

------------------------------------------------------------------------

## 3.7 Animation Layer

Responsible for:

-   visuals only
-   playing clips / blends

Rule:

Animator visualizes combat decisions, never owns them.

------------------------------------------------------------------------

## 3.8 Impact System

Triggered on hit detection.

Impact pipeline:

ImpactEvent → HitStop → Reaction → Camera response → Audio → VFX →
Motion feedback

Purpose:

-   perceived weight
-   hit clarity
-   responsiveness

------------------------------------------------------------------------

# 4. Cross-Cutting Systems

## 4.1 Combat Tags

Tags provide global context:

-   Attacking
-   SuperArmor
-   Cancelable
-   Airborne
-   Blocking

Used by:

-   transitions
-   cancels
-   server validation
-   reaction systems

------------------------------------------------------------------------

## 4.2 Priority / Cancel System

Used to resolve competing actions.

Example priorities:

-   LightAttack = 10
-   HeavyAttack = 15
-   Dodge = 100
-   Stun = 300

Rule:

Higher priority actions can override lower priority actions (if cancel
rules allow).

------------------------------------------------------------------------

## 4.3 Directional Context

Determines which node is chosen based on context.

Example:

LMB + Forward movement → ForwardSlash node

Movement direction must be evaluated relative to camera direction.

------------------------------------------------------------------------

# 5. The Mental Rule (Decision vs Visualization)

Whenever you're unsure where logic belongs:

Ask:

Is this a decision? → CombatController / Graph / Phase system

Is this only presentation? → Animator / VFX / Audio

This rule prevents 90% of architecture failures.

------------------------------------------------------------------------

# 6. Compact Implementation Map

INPUT ↓ CombatController ├ ActionGraph ├ PhaseSystem ├ CancelPriority ├
DirectionalContext └ CombatTags ↓ MotionAuthority ↓ CharacterMotor ↓
Animator (visual only) ↓ ImpactSystem

------------------------------------------------------------------------

# Next Topic (Optional)

Camera-Combat Integration: Why camera behavior becomes a combat system
component for directional control and targeting.
