# BDO-Style Combat -- MMO Networking Integration Strategy

This document explains how to design your combat system so that it can
later support MMO-style networking without requiring large refactors.

It is aligned with the previously defined architecture:

-   CombatController (authority logic)
-   Action Graph
-   Phase Authority
-   Motion Authority
-   Impact System
-   CharacterMotor

The main goal:

üëâ Combat must remain deterministic and network-friendly from day one.

------------------------------------------------------------------------

# 1. Core MMO Networking Principle

In MMO combat:

-   Server must remain authoritative.
-   Client must remain responsive.

This creates a dual requirement:

Server: - validates combat state - owns final truth

Client: - predicts actions locally - shows immediate feedback

------------------------------------------------------------------------

# 2. Combat Architecture Designed for Networking

Your current layered structure is ideal because:

Combat decisions live in CombatController, not Animator.

This allows:

-   deterministic simulation
-   easy replay
-   validation on server.

------------------------------------------------------------------------

# 3. Authority Model

Recommended hybrid:

Client authoritative for input initiation Server authoritative for
validation and resolution.

Flow:

Client sends: CombatIntent + timestamp

Server: validates transition rules checks tags, phase, priority confirms
or rejects.

------------------------------------------------------------------------

# 4. Deterministic Combat Requirements

Avoid:

‚ùå animation-driven timing ‚ùå frame-dependent randomness ‚ùå
physics-based impulses without constraints

Use instead:

-   phase timers
-   data-driven values
-   consistent motion profiles.

------------------------------------------------------------------------

# 5. Networked Action Graph Execution

Client:

-   executes predicted action node
-   starts local animation
-   applies motion intent

Server:

-   runs same graph logic
-   confirms resulting node.

If mismatch occurs:

-   correction applied smoothly.

------------------------------------------------------------------------

# 6. Hit Detection Strategy (MMO Safe)

Preferred model:

Client: - predicts hit for responsiveness

Server: - re-evaluates hit using authoritative state.

Server checks:

-   positions at hit timestamp
-   active phase
-   allowed hit window
-   range validation.

------------------------------------------------------------------------

# 7. Motion Authority and Networking

CharacterMotor should be deterministic.

Avoid:

-   animation root motion authority
-   physics forces depending on frame rate.

Recommended:

MotionAuthority generates impulses from data.

Server and client apply same impulse values.

------------------------------------------------------------------------

# 8. Combat Tags Synchronization

Tags represent combat state.

Examples:

-   Attacking
-   SuperArmor
-   Airborne

Server must maintain authoritative tag set.

Client mirrors for prediction.

------------------------------------------------------------------------

# 9. Cancel and Priority Validation

Client predicts cancel. Server validates:

-   cancel window active?
-   priority allowed?
-   required tags present?

If invalid:

-   rollback or correction.

------------------------------------------------------------------------

# 10. Targeting and Camera Considerations

Camera itself is client-side only.

Server needs:

-   target identifier
-   attack direction vector.

Avoid sending camera state.

------------------------------------------------------------------------

# 11. Latency Compensation Strategies

Possible approaches:

-   input buffering with timestamps
-   server-side rewind for hit validation
-   interpolation smoothing.

------------------------------------------------------------------------

# 12. Recommended Networking Update Flow

Client:

1.  Input ‚Üí CombatIntent
2.  Execute local prediction
3.  Send intent to server.

Server:

1.  Receive intent
2.  Validate via CombatController
3.  Broadcast authoritative state.

Client:

-   reconcile if mismatch.

------------------------------------------------------------------------

# 13. Debugging Tools (Important)

Log:

-   node transitions
-   phase times
-   tag state
-   motion impulses

Deterministic logs allow replay debugging.

------------------------------------------------------------------------

# 14. Common MMO Combat Networking Mistakes

‚ùå Animator-driven gameplay logic

‚ùå Non-deterministic movement

‚ùå Client-only hit detection

‚ùå Mixing physics impulses and gameplay impulses

------------------------------------------------------------------------

# 15. Summary Architecture (Network Ready)

INPUT ‚Üì CombatController (deterministic) ‚îú ActionGraph ‚îú PhaseSystem ‚îú
CancelPriority ‚îú CombatTags ‚îî TargetContext ‚Üì MotionAuthority ‚Üì
CharacterMotor (deterministic) ‚Üì Animator (visual only) ‚Üì ImpactSystem

Server mirrors same logic for validation.

------------------------------------------------------------------------

# Possible Next Topics

-   Enemy AI using same combat graph
-   PvP balancing constraints
-   Animation blending strategies for networking
